<!DOCTYPE html>
<html>
<head>
    <title>3D Online Brawl Stars</title>
    <meta charset="UTF-8">
    <style>
        body { margin: 0; overflow: hidden; font-family: 'Arial', sans-serif; background: #000; }
        #ui { position: fixed; top: 20px; left: 20px; color: white; z-index: 10; pointer-events: none; }
        #lobby { position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: rgba(0,0,0,0.85); padding: 30px; border-radius: 20px; text-align: center; z-index: 100; border: 3px solid #f1c40f; color: white; }
        input { padding: 12px; border-radius: 8px; border: none; width: 250px; margin: 15px 0; font-size: 16px; }
        button { padding: 12px 25px; background: #f1c40f; border: none; cursor: pointer; font-weight: bold; border-radius: 8px; font-size: 16px; transition: 0.3s; }
        button:hover { background: #fff; color: #000; }
        #cheat-indicator { position: fixed; top: 10px; right: 10px; color: #0f0; font-size: 12px; display: none; }
    </style>
</head>
<body>

    <div id="ui">
        <h2>3D BRAWL MOD</h2>
        <div id="my-id-display">ID'niz Oluşturuluyor...</div>
    </div>

    <div id="lobby">
        <h1>BRAWL 3D ONLINE</h1>
        <p>Senin ID: <b id="my-id" style="color:#f1c40f">---</b></p>
        <input type="text" id="target-id" placeholder="Arkadaşının ID'sini buraya yapıştır">
        <br>
        <button onclick="connectToFriend()">DÜNYAYA BAĞLAN</button>
        <p style="font-size: 12px; color: #aaa; margin-top: 15px;">Hareket: WASD | Ateş: Mouse Tık</p>
    </div>

    <div id="cheat-indicator">HİLE AKTİF: Hız + Ölümsüzlük</div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://unpkg.com/peerjs@1.4.7/dist/peerjs.min.js"></script>

    <script>
        let scene, camera, renderer, player, otherPlayer;
        let peer, conn;
        let keys = {};
        let speed = 0.2;
        let isGodMode = false;

        // --- 1. SAHNE VE 3D DÜNYA KURULUMU ---
        function init3D() {
            scene = new THREE.Scene();
            scene.background = new THREE.Color(0x2ecc71); // Yeşil zemin
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            
            renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            document.body.appendChild(renderer.domElement);

            // Zemin Grid
            const grid = new THREE.GridHelper(100, 50, 0x000000, 0x000000);
            grid.position.y = -0.5;
            scene.add(grid);

            // Senin Karakterin (Kutu üzerine 1.png kaplama)
            const texture = new THREE.TextureLoader().load('1.png');
            const geometry = new THREE.BoxGeometry(1, 1, 1);
            const material = new THREE.MeshBasicMaterial({ map: texture });
            player = new THREE.Mesh(geometry, material);
            scene.add(player);

            // Arkadaşının Karakteri (Kırmızı Kutu)
            otherPlayer = new THREE.Mesh(geometry, new THREE.MeshBasicMaterial({ color: 0xff0000 }));
            otherPlayer.position.set(5, 0, 0);
            scene.add(otherPlayer);

            camera.position.y = 10;
            camera.position.z = 10;
            camera.lookAt(player.position);

            animate();
        }

        // --- 2. ONLINE BAĞLANTI (ID SİSTEMİ) ---
        peer = new Peer();
        peer.on('open', (id) => {
            document.getElementById('my-id').innerText = id;
            document.getElementById('my-id-display').innerText = "Senin ID: " + id;
        });

        // Gelen bağlantı
        peer.on('connection', (connection) => {
            conn = connection;
            startOnlineGame();
        });

        function connectToFriend() {
            const target = document.getElementById('target-id').value;
            conn = peer.connect(target);
            startOnlineGame();
        }

        function startOnlineGame() {
            document.getElementById('lobby').style.display = 'none';
            conn.on('data', (data) => {
                if(data.type === 'move') {
                    otherPlayer.position.set(data.x, data.y, data.z);
                }
            });
        }

        // --- 3. HİLE VE KONTROLLER ---
        window.onkeydown = (e) => { 
            keys[e.code] = true; 
            // Gizli Hile Tuşu: 'P' harfine basınca hızı artırır
            if(e.code === 'KeyP') {
                speed = 0.8;
                isGodMode = true;
                document.getElementById('cheat-indicator').style.display = 'block';
            }
        };
        window.onkeyup = (e) => { keys[e.code] = false; };

        function animate() {
            requestAnimationFrame(animate);

            // Hareket Mantığı
            let moved = false;
            if (keys['KeyW']) { player.position.z -= speed; moved = true; }
            if (keys['KeyS']) { player.position.z += speed; moved = true; }
            if (keys['KeyA']) { player.position.x -= speed; moved = true; }
            if (keys['KeyD']) { player.position.x += speed; moved = true; }

            // Kamera Takibi
            camera.position.x = player.position.x;
            camera.position.z = player.position.z + 10;

            // Veriyi arkadaşına gönder
            if (moved && conn && conn.open) {
                conn.send({ type: 'move', x: player.position.x, y: player.position.y, z: player.position.z });
            }

            renderer.render(scene, camera);
        }

        window.onload = init3D;
    </script>
</body>
</html>
